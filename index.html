<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ricette & Lista Spesa</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="assets/icons/icon-512.png">

  <style>
    :root {
      --bg: #f6f7fb;
      --card: #fff;
      --text: #1f2937;
      --muted: #6b7280;
      --primary: #2563eb;
      --primary-600: #1d4ed8;
      --green: #16a34a;
      --green-700:#15803d;
      --chip: #eef2ff;
      --chip-active:#c7d2fe;
      --border:#e5e7eb;
      --shadow: 0 6px 20px rgba(0,0,0,.06);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font: 15px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text); background: var(--bg);
    }
    header { position: sticky; top: 0; z-index: 5; backdrop-filter: blur(6px); background: color-mix(in srgb, var(--bg) 85%, white 15%); border-bottom:1px solid var(--border); }
    .container { max-width: 1080px; margin: 0 auto; padding: 16px; }
    h1 { margin: 0 0 8px; font-size: 20px; }
    .muted { color: var(--muted); }
    .toolbar { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .search { flex: 1 1 260px; padding: 10px 12px; border:1px solid var(--border); border-radius: 10px; background: #fff; }
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 10px; border:1px solid transparent;
      background: var(--primary); color: #fff; cursor: pointer;
      box-shadow: var(--shadow);
    }
    .btn:hover { background: var(--primary-600); }
    .btn-ghost{ background:#fff; color: var(--text); border-color: var(--border); box-shadow: none; }
    .btn-ghost:hover{ background:#f9fafb; }
    .chipbar { display: flex; gap: 8px; flex-wrap: wrap; margin: 10px 0 2px; }
    .chip {
      background: var(--chip); border:1px solid var(--border); color: #374151;
      padding:6px 10px; border-radius: 999px; cursor: pointer; user-select: none;
    }
    .chip.active { background: var(--chip-active); }

    /* Generatore */
    .gen { background: var(--card); border:1px solid var(--border); border-radius: 14px; padding: 12px; box-shadow: var(--shadow); margin: 8px 0 16px; }
    .gen-grid { display: grid; grid-template-columns: 1fr 320px; gap: 12px; }
    textarea { width: 100%; min-height: 90px; resize: vertical; padding:10px; border:1px solid var(--border); border-radius: 10px; }

    /* Cards */
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
    @media (max-width: 980px){ .grid{grid-template-columns: repeat(2, 1fr);} .gen-grid{grid-template-columns: 1fr;} }
    @media (max-width: 640px){ .grid{grid-template-columns: 1fr;} }

    .recipe-card {
      background: var(--card); border:1px solid var(--border); border-radius: 16px;
      padding: 12px; display: grid; grid-template-columns: 92px 1fr; gap: 12px;
      box-shadow: var(--shadow);
    }
    .thumb { width: 92px; height: 92px; object-fit: cover; border-radius: 12px; border:1px solid var(--border); background:#fff; }
    .body h3 { margin: 0 0 6px; font-size: 16px; }
    .meta { margin: 0 0 6px; color: var(--muted); }
    .tags { display: flex; gap: 6px; flex-wrap: wrap; margin: 8px 0; }
    .tag { font-size: 12px; padding: 4px 8px; border-radius: 999px; background:#eef2f7; color:#374151; border:1px solid var(--border) }
    .actions { display: flex; gap: 8px; flex-wrap: wrap; }

    /* Modale video */
    .vm { position:fixed; inset:0; display:none; align-items:center; justify-content:center; }
    .vm.show { display:flex; }
    .vm .vm-backdrop { position:absolute; inset:0; background: rgba(0,0,0,.55); }
    .vm .vm-panel { position:relative; z-index:2; width:min(960px, calc(100vw - 24px)); aspect-ratio:16/9; background:#000; border-radius:14px; box-shadow: var(--shadow); overflow:hidden; }
    .vm header { position:absolute; inset:auto 8px 100% auto; display:flex; justify-content:flex-end; }
    .vm button#video-close { background:#111827; color:#fff; border-radius: 10px; padding:6px 10px; border:1px solid #1f2937; }
    .vm iframe { width:100%; height:100%; border:0; display:block; border-radius: 14px; }
    .no-scroll { overflow: hidden; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Ricette & Lista Spesa <span class="muted" id="app-version">v…</span></h1>

      <!-- Toolbar -->
      <div class="toolbar">
        <input id="search" class="search" placeholder="Cerca ricette o ingredienti…" />
        <label class="muted"><input id="only-fav" type="checkbox" /> Solo preferiti</label>
        <button id="refresh" class="btn btn-ghost">Aggiorna dati</button>
      </div>

      <!-- Chips -->
      <div id="chipbar" class="chipbar">
        <button class="chip active" data-tag="tutti">Tutti</button>
        <button class="chip" data-tag="onnivoro">onnivoro</button>
        <button class="chip" data-tag="primo">primo</button>
        <button class="chip" data-tag="veloce">veloce</button>
        <button class="chip" data-tag="4-ingredienti">4-ingredienti</button>
        <button class="chip" data-tag="dispensa">dispensa</button>
        <button class="chip" data-tag="comfort">comfort</button>
        <button class="chip" data-tag="secondo">secondo</button>
        <button class="chip" data-tag="leggero">leggero</button>
        <button class="chip" data-tag="antipasto">antipasto</button>
        <button class="chip" data-tag="vegetariano">vegetariano</button>
        <button class="chip" data-tag="estate">estate</button>
      </div>
    </div>
  </header>

  <main class="container">

    <!-- Generatore antispreco -->
    <section class="gen">
      <h3 style="margin:0 0 8px;">Generatore antispreco</h3>
      <div class="gen-grid">
        <div>
          <textarea id="ingredients" placeholder="Scrivi ingredienti separati da virgola o a capo (es: spaghetti, aglio, olio, peperoncino)…"></textarea>
          <div style="display:flex; gap:8px; align-items:center; margin-top:8px;">
            <button id="btn-suggest" class="btn btn-ghost">Suggerisci ricette</button>
            <span class="muted" style="font-size:13px;">Suggerimento: incolla anche l’etichetta di un prodotto – l’OCR la leggerà per te.</span>
          </div>
        </div>
        <div>
          <!-- fotocamera (stubs) -->
          <div style="background:#000; width:100%; height:180px; border-radius:10px;"></div>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button class="btn btn-ghost" id="btn-camera-open">Apri fotocamera</button>
            <button class="btn btn-ghost" id="btn-ocr">Scatta & OCR</button>
            <button class="btn btn-ghost" id="btn-camera-close">Chiudi camera</button>
          </div>
          <small class="muted">Il testo riconosciuto sarà aggiunto al box ingredienti.</small>
        </div>
      </div>
    </section>

    <!-- Lista ricette -->
    <section id="recipes" class="grid" aria-live="polite"></section>
  </main>

  <!-- Modale Video -->
  <div id="video-modal" class="vm" aria-hidden="true">
    <div class="vm-backdrop" role="button" aria-label="Chiudi"></div>
    <div class="vm-panel">
      <header>
        <button id="video-close" title="Chiudi">✕</button>
      </header>
      <iframe
        id="yt-frame"
        src="about:blank"
        allow="autoplay; encrypted-media; picture-in-picture"
        allowfullscreen
        referrerpolicy="no-referrer">
      </iframe>
    </div>
  </div>

  <!-- Loader robusto dello script applicativo -->
  <script>
    window.APP_VERSION = 'vdev5';
    (function () {
      const v = '?v=' + encodeURIComponent(window.APP_VERSION);
      const candidates = [
        'script/app_v16.js',   // <— percorso ufficiale
        'script/app.v16.js',
        'scripts/app_v16.js',
        'scripts/app.v16.js',
        'app_v16.js',
        'app.v16.js'
      ];
      (function tryNext(i){
        if (i >= candidates.length) {
          console.error('Nessun file app trovato. Controlla nome/cartella.');
          return;
        }
        const s = document.createElement('script');
        s.src = candidates[i] + v;
        s.onerror = () => tryNext(i + 1);
        document.head.appendChild(s);
      })(0);
    })();
  </script>
</body>
</html>
