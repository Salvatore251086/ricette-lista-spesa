<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ricette & Lista Spesa</title>
  <meta name="description" content="Ricette, lista della spesa, fotocamera con OCR e video tutorial.">
  <meta name="theme-color" content="#ffffff">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
  <link rel="icon" href="assets/icons/icon-192.png">
  <link rel="stylesheet" href="styles.css?v=2025-10-27-6">
  <style>
    :root { color-scheme: light dark }
    * { box-sizing: border-box }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: #fff; color: #111 }
    .wrap { max-width: 1120px; margin: 0 auto; padding: 16px }
    header { position: sticky; top: 0; z-index: 10; background: rgba(255,255,255,0.9); backdrop-filter: blur(6px); border-bottom: 1px solid #ececec }
    .brand { display: flex; align-items: center; gap: 10px; font-weight: 700 }
    .brand img { width: 24px; height: 24px; border-radius: 6px }
    .toolbar { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; align-items: center }
    .search { flex: 1 1 260px; display: flex; align-items: center; gap: 8px; border: 1px solid #e3e3e3; border-radius: 10px; padding: 8px 10px; background: #fafafa }
    .search input { width: 100%; border: 0; outline: 0; background: transparent; font-size: 15px }
    .chips { display: flex; gap: 6px; overflow-x: auto; padding: 4px 0 }
    .chip { padding: 6px 10px; font-size: 13px; border: 1px solid #e3e3e3; background: #fff; border-radius: 999px; cursor: pointer }
    .chip[aria-selected="true"] { background: #0a84ff; border-color: #0a84ff; color: #fff }
    .right-tools { margin-left: auto; display: inline-flex; gap: 8px; align-items: center }
    main { background: #f8f8f8 }
    .panel { background: #fff; border: 1px solid #ececec; border-radius: 12px; padding: 12px; margin-top: 14px }
    .panel h2 { margin: 0 0 8px 0; font-size: 16px }
    .panel .grid { display: grid; grid-template-columns: 1.3fr 1fr; gap: 12px }
    .box { border: 1px solid #ececec; border-radius: 10px; background: #fff }
    .box textarea { width: 100%; min-height: 96px; border: 0; outline: 0; resize: vertical; padding: 10px; font-size: 14px }
    .camera-box { padding: 8px }
    .camera-frame { background: #000; border-radius: 8px; aspect-ratio: 16/9 }
    .camera-actions { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-top: 8px }
    .camera-actions button, .camera-actions label { padding: 8px; font-size: 13px; border-radius: 8px; border: 1px solid #e3e3e3; background: #fff; cursor: pointer; text-align: center }
    .hint { font-size: 12px; color: #666; margin-top: 6px }
    .cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; margin: 16px 0 40px }
    .card { background: #fff; border: 1px solid #ececec; border-radius: 12px; overflow: hidden }
    .thumb { position: relative; background: #000; aspect-ratio: 16/9 }
    .thumb img { width: 100%; height: 100%; object-fit: cover; display: block }
    .card-body { padding: 10px }
    .tags { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px }
    .tag { font-size: 11px; padding: 2px 6px; border-radius: 999px; background: #f1f5f9; border: 1px solid #e5e7eb }
    .row { display: flex; align-items: center; justify-content: space-between; gap: 8px; margin-top: 8px }
    .row a, .row button { font-size: 13px; padding: 6px 10px; border-radius: 8px; border: 1px solid #e3e3e3; background: #fff; cursor: pointer }
    footer { color: #666; padding: 16px }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0 0 1px 1px); white-space: nowrap; border: 0 }
    /* badge delta */
    .rls-delta-badge { margin-left: 8px; background: #0a84ff; color: #fff; font-size: 11px; padding: 2px 6px; border-radius: 999px; display: none }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <img src="assets/icons/icon-192.png" alt="Logo" onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2264%22 height=%2264%22 viewBox=%220 0 64 64%22><rect width=%2264%22 height=%2264%22 fill=%22%23111%22/><text x=%2232%22 y=%2238%22 font-size=%2220%22 text-anchor=%22middle%22 fill=%22%23fff%22>RLS</text></svg>'">
        <span>Ricette & Lista Spesa</span>
      </div>

      <div class="toolbar">
        <div class="search" aria-label="Cerca">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.2-4.2m1.7-5.3a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <input id="q" type="search" placeholder="Cerca ricette o ingredienti">
        </div>

        <div class="chips" role="tablist" aria-label="Filtri">
          <button class="chip" data-chip="tutti" role="tab" aria-selected="true">Tutti</button>
          <button class="chip" data-chip="onnivoro" role="tab" aria-selected="false">onnivoro</button>
          <button class="chip" data-chip="primo" role="tab" aria-selected="false">primo</button>
          <button class="chip" data-chip="veloce" role="tab" aria-selected="false">veloce</button>
          <button class="chip" data-chip="4-ingredienti" role="tab" aria-selected="false">4-ingredienti</button>
          <button class="chip" data-chip="dispensa" role="tab" aria-selected="false">dispensa</button>
          <button class="chip" data-chip="secondo" role="tab" aria-selected="false">secondo</button>
          <button class="chip" data-chip="leggero" role="tab" aria-selected="false">leggero</button>
          <button class="chip" data-chip="antipasto" role="tab" aria-selected="false">antipasto</button>
          <button class="chip" data-chip="vegetariano" role="tab" aria-selected="false">vegetariano</button>
          <button class="chip" data-chip="estate" role="tab" aria-selected="false">estate</button>
        </div>

        <div class="right-tools">
          <label class="row" style="gap:6px">
            <input id="soloPreferiti" type="checkbox">
            <span>Solo preferiti</span>
          </label>
          <button id="btnAggiorna">Aggiorna dati</button>
          <span class="rls-delta-badge" id="deltaBadge">0</span>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">

      <section class="panel" aria-labelledby="genTitle">
        <h2 id="genTitle">Generatore antispreco</h2>
        <div class="grid">
          <div class="box">
            <textarea id="ingredients" placeholder="Scrivi ingredienti separati da virgola o a capo, esempio: spaghetti, aglio, olio, peperoncino."></textarea>
            <div class="row">
              <button id="btnSuggerisci">Suggerisci ricette</button>
              <span class="hint">Suggerimento, incolla anche l’etichetta di un prodotto, l’OCR la leggerà.</span>
            </div>
          </div>

          <div class="box camera-box">
            <div class="camera-frame rls-camera-frame" style="width:100%; border:1px solid #ececec; border-radius:8px"></div>
            <div class="camera-actions">
              <button type="button">Apri fotocamera</button>
              <button type="button" disabled>Scatta & OCR</button>
              <button type="button" disabled>Chiudi camera</button>
              <label>
                Carica foto
                <input id="filePicker" type="file" accept="image/*" style="display:none">
              </label>
            </div>
            <div class="hint">Il testo riconosciuto sarà aggiunto al box ingredienti. Trascina qui una foto per l’OCR.</div>
          </div>
        </div>
      </section>

      <section class="cards" id="cards">
        <!-- Esempi statici, sostituisci con il tuo render -->
        <article class="card" data-recipe-id="r1">
          <div class="thumb">
            <img src="assets/screenshots/pasta-tonno.jpg" alt="Pasta al tonno" onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22160%22 height=%2290%22 viewBox=%220 0 160 90%22><rect width=%22160%22 height=%2290%22 fill=%22%23000%22/><text x=%2280%22 y=%2250%22 font-size=%2212%22 text-anchor=%22middle%22 fill=%22%23fff%22>nessuna immagine</text></svg>'">
          </div>
          <div class="card-body">
            <strong>Pasta al tonno veloce</strong>
            <div class="tags">
              <span class="tag">primo</span>
              <span class="tag">veloce</span>
              <span class="tag">onnivoro</span>
            </div>
            <div class="row">
              <a href="#" aria-label="Apri ricetta">Ricetta</a>
              <button type="button" data-video-id="dQw4w9WgXcQ">Guarda video</button>
            </div>
          </div>
        </article>

        <article class="card" data-recipe-id="r2">
          <div class="thumb">
            <img src="assets/screenshots/cacio-pepe.jpg" alt="Spaghetti cacio e pepe" onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22160%22 height=%2290%22 viewBox=%220 0 160 90%22><rect width=%22160%22 height=%2290%22 fill=%22%23000%22/><text x=%2280%22 y=%2250%22 font-size=%2212%22 text-anchor=%22middle%22 fill=%22%23fff%22>nessuna immagine</text></svg>'">
          </div>
          <div class="card-body">
            <strong>Spaghetti cacio e pepe</strong>
            <div class="tags">
              <span class="tag">primo</span>
              <span class="tag">4-ingredienti</span>
              <span class="tag">onnivoro</span>
            </div>
            <div class="row">
              <a href="#" aria-label="Apri ricetta">Ricetta</a>
              <button type="button" data-video-id="hY7m5jjJ9mM">Guarda video</button>
            </div>
          </div>
        </article>

        <article class="card" data-recipe-id="r3">
          <div class="thumb">
            <img src="assets/screenshots/bruschette.jpg" alt="Bruschette al pomodoro" onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22160%22 height=%2290%22 viewBox=%220 0 160 90%22><rect width=%22160%22 height=%2290%22 fill=%22%23000%22/><text x=%2280%22 y=%2250%22 font-size=%2212%22 text-anchor=%22middle%22 fill=%22%23fff%22>nessuna immagine</text></svg>'">
          </div>
          <div class="card-body">
            <strong>Bruschette al pomodoro</strong>
            <div class="tags">
              <span class="tag">antipasto</span>
              <span class="tag">vegetariano</span>
              <span class="tag">estate</span>
            </div>
            <div class="row">
              <a href="#" aria-label="Apri ricetta">Ricetta</a>
              <button type="button" data-video-id="hY7m5jjJ9mM">Guarda video</button>
            </div>
          </div>
        </article>
      </section>

      <footer>
        <small>V. <span id="appVersion">dev</span> • Funziona offline dove possibile</small>
      </footer>
    </div>
  </main>

  <script>
    window.APP_VERSION = 'rls-2025.10.27.6'
    document.addEventListener('DOMContentLoaded', function(){
      var v = document.getElementById('appVersion')
      if (v) v.textContent = window.APP_VERSION
      var picker = document.getElementById('filePicker')
      if (picker){
        picker.addEventListener('change', function(evt){
          var f = evt.target.files && evt.target.files[0]
          if (!f) return
          var r = new FileReader()
          r.onload = function(){ fetch(r.result).then(res => res.blob()).then(b => document.dispatchEvent(new CustomEvent('camera:snapshot', { detail: { blob: b, dataURL: r.result } }))) }
          r.readAsDataURL(f)
        })
      }
      if ('serviceWorker' in navigator){
        navigator.serviceWorker.register('service-worker.js?v=2025-10-27-6').catch(function(){})
      }
    })
  </script>

  <!-- Strumenti diagnostica e funzionali -->
  <script src="script/debug-tools.v1.js?v=2025-10-27-3"></script>

  <!-- Modale video con fallback aggressivo + fix warning iframe -->
  <script src="script/video-modal.v4.js?v=2025-10-27-1"></script>
  <script src="script/iframe-sanitize.v1.js?v=2025-10-27-1"></script>

  <!-- Fallback immagini globali -->
  <script src="script/img-fallback.v1.js?v=2025-10-27-1"></script>

  <!-- Adapter click “Guarda video” su elementi esistenti -->
  <script src="script/video-adapter.v1.js?v=2025-10-27-1"></script>

  <!-- Fotocamera + OCR -->
  <script src="script/camera.v3.js?v=2025-10-27-1"></script>
  <script src="script/ocr-bridge.v2.js?v=2025-10-27-1"></script>

  <!-- Delta ricette e mini changelog vicino ad “Aggiorna dati” -->
  <script src="script/recipes-delta.v1.js?v=2025-10-27-1"></script>
</body>
</html>
