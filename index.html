<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Ricette & Lista Spesa — App</title>
  <meta name="description" content="Ricette anti-spreco in base a ciò che hai in frigo, lista spesa smart e offerte vicine a te. Installa l’app e unisciti al canale WhatsApp." />
  <meta name="google-site-verification" content="xev3DqnBe5S6W48LQVc5vbtMvPEosTWEJkgLT3ICqko" />

  <!-- Favicon / Icone (percorsi RELATIVI) -->
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="assets/icons/icon-192.png" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#22C55E" />

  <!-- Social -->
  <meta property="og:title" content="Ricette & Lista Spesa — App" />
  <meta property="og:description" content="Trasforma ciò che hai in frigo in piatti veloci. PWA + canale WhatsApp." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://salvatore251086.github.io/ricette-lista-spesa/" />
  <meta property="og:image" content="assets/screenshots/home-wide-1920x1080.png" />

  <!-- Stili principali -->
  <link rel="stylesheet" href="styles.css?v=3" />

  <!-- GA4 (lasciato invariato) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TVG9647DD4"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config','G-TVG9647DD4');
  </script>

  <!-- Piccole aggiunte di stile per le nuove sezioni (coerenti con le tue classi) -->
  <style>
    .grid { display:grid; gap:16px; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); }
    .waitlist form { display:grid; gap:10px; grid-template-columns:1fr auto; }
    .waitlist input[type="email"] { padding:.75rem; border:1px solid #e5e7eb; border-radius:.75rem; min-width:0; }
    .waitlist .btn { white-space:nowrap; }
    @media (max-width:640px){ .waitlist form{ grid-template-columns:1fr; } }
  </style>
</head>

<body>
  <header class="site-header">
    <div class="brand">
      <img src="assets/icons/icon-192.png" alt="Logo Ricette & Lista Spesa" width="40" height="40" />
      <span>Ricette & Lista Spesa</span>
    </div>

    <nav class="site-nav">
      <a class="nav-link" href="privacy.html">Privacy</a>
      <a class="nav-link" href="terms.html">Termini</a>
      <a class="nav-link" href="offline.html">Offline</a>
    </nav>
  </header>

  <main class="container">
    <!-- HERO (dal tuo file attuale) -->
    <section class="hero card">
      <div class="hero-text">
        <h1>Ricette antispreco + Lista Spesa smart</h1>
        <p class="lead">
          Trasforma ciò che hai in frigo in piatti super veloci. Installa l’app PWA e unisciti al canale WhatsApp per ricette e offerte vicino a te.
        </p>
      </div>

      <div class="cta-row">
        <!-- Bottone di installazione PWA (gestito da app.js) -->
        <button data-install-app class="btn btn-primary btn-pill" disabled>
          Installa l’app
        </button>

        <!-- Link al canale WhatsApp (richiesta recente) -->
        <a class="btn btn-secondary btn-pill"
           href="https://whatsapp.com/channel/0029Vb6la2aCHDycDs8wsn2h"
           target="_blank" rel="noopener">
          Apri il canale WhatsApp
        </a>
      </div>

      <p class="note">
        Se il tasto “Installa l’app” non appare, apri questa pagina con Chrome/Edge su Android o Safari su iPhone e usa “Aggiungi alla schermata Home”.
      </p>

      <!-- Piani + link Stripe (come nel tuo file attuale) -->
      <div class="plan card soft">
        <strong>Piani:</strong>
        <span class="badge">Starter 2,99€/mese</span>
        <span class="badge badge-pro">Pro 19,99€/mese</span>
        <div class="plan-actions">
          <a class="btn btn-outline btn-pill"
             href="https://buy.stripe.com/test_4gMcN57QX8Ubg3jf0LcZa04">
            Attiva Starter
          </a>
          <a class="btn btn-pro btn-pill"
             href="https://buy.stripe.com/test_3cIbJ1fjp3zRdVb05RcZa01">
            Attiva Pro
          </a>
        </div>
      </div>
    </section>

    <!-- FUNZIONI (portate dal primo file, adattate al tuo stile) -->
    <section class="card">
      <h2>Funzioni principali</h2>
      <div class="grid">
        <div class="card"><h3>Piano pasti</h3><p>7 giorni in un colpo solo. Ingredienti raggruppati automaticamente.</p></div>
        <div class="card"><h3>Condivisione</h3><p>Spunte sincrone tra partner e coinquilini per zero confusione.</p></div>
        <div class="card"><h3>Offline</h3><p>La lista resta disponibile anche senza rete.</p></div>
        <div class="card"><h3>Scanner</h3><p>Segna “preso” col codice a barre, rapido e preciso.</p></div>
      </div>
    </section>

    <!-- DEMO/ANTEPRIMA (immagini esistenti per evitare 404) -->
    <section class="card">
      <h2>Anteprima</h2>
      <div class="screens">
        <img src="assets/screenshots/home-wide-1920x1080.png" alt="Anteprima desktop" loading="lazy" />
        <img src="assets/screenshots/home-narrow-1080x1920.png" alt="Anteprima mobile" loading="lazy" />
      </div>
    </section>

    <!-- WAITLIST (dal primo file; invio a /functions/api/waitlist con fallback) -->
    <section class="card waitlist">
      <h2>Lista d’attesa</h2>
      <p class="muted">Vuoi provarla appena sblocchiamo le prossime funzioni? Lascia la mail.</p>
      <form id="waitlist-form" novalidate>
        <input id="waitlist-email" type="email" placeholder="tua@email.it" required />
        <button class="btn btn-primary btn-pill" type="submit">Iscriviti</button>
      </form>
      <p id="waitlist-ok" class="muted" style="display:none;color:#0a7">Iscritto! Ti avviseremo qui.</p>
    </section>

    <!-- Novità & notifiche (sezione esistente) -->
    <section class="card">
      <h2>Novità & notifiche</h2>
      <p class="muted">
        Per iniziare senza complicazioni usiamo il canale WhatsApp per gli avvisi. Le push browser arriveranno in seguito.
      </p>
    </section>
  </main>

  <footer class="site-footer">
    © <span id="year"></span> Ricette & Lista Spesa — PWA
  </footer>

  <!-- App logic: registra SW e gestisci install (come nel tuo file attuale) -->
  <script src="app.js?v=3" defer></script>

  <!-- Service Worker (percorso RELATIVO!) + utilità -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .catch(err => console.warn('SW registration failed:', err));
      });
    }

    // Anno footer
    window.addEventListener('DOMContentLoaded', () => {
      const y = document.getElementById('year');
      if (y) y.textContent = new Date().getFullYear();
    });

    // Waitlist: semplice POST con fallback locale
    (function () {
      const form = document.getElementById('waitlist-form');
      const email = document.getElementById('waitlist-email');
      const ok = document.getElementById('waitlist-ok');
      if (!form) return;

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!email.checkValidity()) { email.focus(); return; }
        try {
          const res = await fetch('/functions/api/waitlist', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: email.value })
          });
          if (!res.ok) throw new Error('Bad response');
          ok.style.display = 'block';
          form.reset();
        } catch (err) {
          alert('Iscrizione non riuscita, riprova tra poco.');
        }
      });
    })();
  </script>
</body>
</html>
