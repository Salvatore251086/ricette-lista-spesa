<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ricette & Lista Spesa</title>
  <meta name="description" content="Zero sprechi, più idee in cucina." />
  <meta name="robots" content="index,follow" />
  <link rel="icon" href="favicon.ico" />
  <link rel="manifest" href="manifest.webmanifest" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;color:#111;background:#fafafa}
    header,footer{padding:12px 16px}
    .bar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .chip{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #ddd;background:#fff;font-size:14px;cursor:pointer}
    .chip.active{background:#111;color:#fff;border-color:#111}
    .muted{color:#666}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;padding:16px}
    .card{background:#fff;border:1px solid #eee;border-radius:12px;overflow:hidden;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .card .thumb{width:100%;height:160px;object-fit:cover;background:#f2f2f2}
    .card .b{padding:12px}
    .btn{display:inline-block;margin-right:8px;margin-top:6px;padding:8px 10px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .btn[disabled]{opacity:.5;cursor:not-allowed}
    .btn.green{background:#e8f5e9;border-color:#a5d6a7}
    .btn.blue{background:#e3f2fd;border-color:#90caf9}
    .row{padding:8px 16px}
    .input{padding:8px 10px;border:1px solid #ddd;border-radius:8px;min-width:260px}
    .right{margin-left:auto}
    /* Video modal */
    .vm{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:16px}
    .vm.show{display:flex}
    .vm .box{background:#000;max-width:900px;width:100%;aspect-ratio:16/9;position:relative;border-radius:8px;overflow:hidden}
    .vm iframe{width:100%;height:100%;border:0}
    .vm .x{position:absolute;top:8px;right:8px;background:#fff;border:0;border-radius:8px;padding:6px 10px;cursor:pointer}
    /* Camera */
    .cam-wrap{padding:12px 16px;border-top:1px solid #eee}
    .cam-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:8px 0}
    video,canvas{width:360px;height:200px;background:#000;border-radius:8px}
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <strong>Ricette & Lista Spesa <span id="app-version" class="muted"></span></strong>
      <label><input type="checkbox" id="only-fav" /> Solo preferiti</label>
      <button id="refresh" class="btn">Aggiorna dati</button>
      <input id="search" class="input right" type="search" placeholder="Cerca ricette o ingredienti" />
    </div>
    <div id="chipbar" class="bar">
      <span class="chip active" data-tag="tutti">Tutti</span>
      <span class="chip" data-tag="4-ingredienti">4-ingredienti</span>
      <span class="chip" data-tag="antipasto">antipasto</span>
      <span class="chip" data-tag="comfort">comfort</span>
      <span class="chip" data-tag="dispensa">dispensa</span>
      <span class="chip" data-tag="estate">estate</span>
      <span class="chip" data-tag="leggero">leggero</span>
      <span class="chip" data-tag="onnivoro">onnivoro</span>
      <span class="chip" data-tag="primo">primo</span>
      <span class="chip" data-tag="secondo">secondo</span>
      <span class="chip" data-tag="vegetariano">vegetariano</span>
      <span class="chip" data-tag="veloce">veloce</span>
    </div>
    <div class="row">
      <label class="muted">Generatore antispreco</label>
      <div class="bar">
        <textarea id="ingredients" class="input" rows="2" style="min-width:420px" placeholder="Scrivi ingredienti separati da virgola o a capo"></textarea>
        <button id="btn-suggest" class="btn">Suggerisci ricette</button>
      </div>
    </div>
  </header>

  <section class="cam-wrap">
    <h3>Fotocamera OCR</h3>
    <div class="cam-row">
      <video id="cam-video" playsinline muted></video>
      <canvas id="cam-canvas" width="360" height="200"></canvas>
    </div>
    <div class="cam-row">
      <button id="cam-open" class="btn">Apri fotocamera</button>
      <button id="cam-shot" class="btn" disabled>Scatta</button>
      <button id="cam-close" class="btn" disabled>Chiudi</button>
      <select id="cam-dev" class="input" style="min-width:280px"></select>
      <input id="cam-file" type="file" accept="image/*" />
    </div>
    <p class="muted">Il testo riconosciuto sarà aggiunto al box ingredienti. OCR leggero, placeholder.</p>
  </section>

  <main>
    <section id="recipes" class="grid"></section>
  </main>

  <footer>
    <small>Zero sprechi, più idee in cucina. <span id="badge-ver">v16.9</span></small>
  </footer>

  <div id="video-modal" class="vm" aria-hidden="true">
    <div class="box">
      <button id="video-close" class="x">Chiudi</button>
      <iframe id="yt-frame" src="about:blank" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen referrerpolicy="strict-origin-when-cross-origin" loading="lazy"></iframe>
    </div>
  </div>

  <script>
    window.APP_VERSION = '16.9';
    document.getElementById('app-version')?.append(' v' + window.APP_VERSION);
    document.getElementById('badge-ver')?.replaceChildren('v' + window.APP_VERSION);
  </script>

  <script
    src="script/app_v16.js?v=16.9"
    defer
    onerror="this.remove();(function(){var s=document.createElement('script');s.src='script/app_v16.js?v=fallback';s.defer=true;document.head.appendChild(s);}())">
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
      });
    }
  </script>
</body>
</html>
