<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ricette & Lista Spesa</title>

  <link rel="icon" href="./favicon.ico">
  <link rel="manifest" href="./manifest.webmanifest?v=20">
  <link rel="preload" href="./styles.css?v=20" as="style">
  <link rel="stylesheet" href="./styles.css?v=20">

  <meta name="theme-color" content="#ffffff">
</head>
<body>
  <header class="app-header">
    <h1>Ricette & Lista Spesa</h1>
    <div class="toolbar">
      <input id="q" type="search" placeholder="Cerca ricette">
      <button id="reloadData">Aggiorna dati</button>
      <button id="devToggle">Dev</button>
    </div>
  </header>

  <main id="app">
    <section id="cards" class="cards"></section>

    <section id="yt-audit" class="panel">
      <div class="panel-header">
        <h2>Verifica YouTube</h2>
        <div class="audit-filters">
          <span>Righe totali: <b id="ytTotal">0</b></span>
          <button type="button" data-filter="all" class="chip chip--on">Tutte</button>
          <button type="button" data-filter="verified" class="chip">Verificate <span id="ytOk">0</span></button>
          <button type="button" data-filter="low" class="chip">Bassa conf. <span id="ytLow">0</span></button>
          <button type="button" data-filter="missing" class="chip">Mancanti <span id="ytMissing">0</span></button>
        </div>
      </div>

      <div class="table-wrap">
        <table class="table" id="ytTable">
          <thead>
            <tr>
              <th>Titolo ricetta</th>
              <th>youtubeId</th>
              <th>Titolo video</th>
              <th>Canale</th>
              <th>Conf.</th>
              <th>Azioni</th>
            </tr>
          </thead>
          <tbody id="ytBody">
            <tr><td colspan="6" class="muted">Caricamento…</td></tr>
          </tbody>
        </table>
        <div class="hint">Soglia verifica 0.25. Clic su Guarda video apre modale</div>
      </div>
    </section>

    <dialog id="videoModal">
      <div class="video-frame">
        <iframe id="videoFrame" src="" title="YouTube" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen referrerpolicy="origin-when-cross-origin"></iframe>
      </div>
      <div class="modal-actions">
        <button id="closeModal" class="btn">Chiudi</button>
        <a id="openExternal" target="_blank" rel="noopener" class="btn btn-alt">Apri su YouTube</a>
      </div>
    </dialog>
  </main>

  <footer class="app-footer">Zero sprechi, più idee in cucina.</footer>

  <script src="./app.v16.js?v=20" defer></script>
  <script src="./assets/js/yt-audit.v2.js?v=20" defer></script>

  <script>
    // SW helper
    if (location.search.includes('nocache=1') && 'serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(list => list.forEach(r => r.unregister()));
      if (window.caches && caches.keys) caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
    }
    if ('serviceWorker' in navigator && !location.search.includes('nosw=1')) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js?v=20').catch(()=>{});
      });
    }
  </script>
</body>
</html>
