<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ricette & Lista Spesa</title>
  <meta name="description" content="Zero sprechi, più idee in cucina.">
  <link rel="icon" href="./favicon.ico">
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="robots" content="index,follow">
  <style>
    :root{--g:10px;--c:#0ea5e9;--b:#222;--m:#667;--bg:#f6f7fb}
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.4 system-ui,Segoe UI,Roboto,Arial;background:#fff;color:#111}
    header,main,footer{max-width:1100px;margin:0 auto;padding:14px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    input[type="text"]{padding:9px 10px;border:1px solid #ddd;border-radius:8px;min-width:240px}
    .btn{padding:8px 12px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer}
    .btn[disabled]{opacity:.5;cursor:not-allowed}
    .btn.blue{background:#e6f6ff;border-color:#bfe8ff;color:#045}
    .btn.green{background:#eaffea;border-color:#c7f3c7;color:#063}
    .chipbar{display:flex;gap:6px;flex-wrap:wrap;margin:10px 0}
    .chip{padding:6px 10px;border:1px solid #ddd;border-radius:20px;cursor:pointer;font-size:14px;background:#fff}
    .chip.active{background:#000;color:#fff;border-color:#000}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px}
    .card{border:1px solid #eee;border-radius:12px;overflow:hidden;background:#fff;display:flex;flex-direction:column}
    .card .thumb{width:100%;height:160px;object-fit:cover;background:#fafafa}
    .card .b{padding:12px}
    .meta{color:#666;font-size:13px;margin:.25rem 0}
    .tags{display:flex;flex-wrap:wrap;gap:6px;margin:.25rem 0}
    .tag{font-size:12px;padding:4px 8px;border:1px solid #eee;border-radius:999px}
    .act{display:flex;gap:8px;margin-top:.5rem}
    .muted{color:#666}
    /* Video modal */
    .vm{position:fixed;inset:0;display:none}
    .vm.show{display:block}
    .vm .bg{position:absolute;inset:0;background:rgba(0,0,0,.6)}
    .vm .box{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:20px}
    .vm .inner{width:min(960px,96vw);aspect-ratio:16/9;background:#000;border-radius:12px;overflow:hidden;position:relative}
    .vm iframe{width:100%;height:100%;border:0}
    .vm .close{position:absolute;top:8px;right:8px;background:#fff;border:1px solid #ddd;border-radius:999px;padding:6px 10px;cursor:pointer}
    /* Camera */
    .cam{border:1px dashed #ddd;border-radius:12px;padding:12px;margin:10px 0;background:#fafafa}
    .cam .row{align-items:center}
    .cam video,.cam canvas{width:100%;max-width:520px;height:280px;background:#000;border-radius:10px}
    footer small{color:#667}
  </style>
</head>
<body>

<header>
  <div class="row">
    <label><input type="checkbox" id="only-fav"> Solo preferiti</label>
    <button class="btn" id="refresh">Aggiorna dati</button>
    <input id="search" type="text" placeholder="Cerca ricette o ingredienti">
    <span id="app-version" class="muted"></span>
  </div>

  <nav id="chipbar" class="chipbar">
    <button class="chip active" data-tag="tutti">Tutti</button>
    <button class="chip" data-tag="4-ingredienti">4-ingredienti</button>
    <button class="chip" data-tag="antipasto">antipasto</button>
    <button class="chip" data-tag="comfort">comfort</button>
    <button class="chip" data-tag="dispensa">dispensa</button>
    <button class="chip" data-tag="estate">estate</button>
    <button class="chip" data-tag="leggero">leggero</button>
    <button class="chip" data-tag="onnivoro">onnivoro</button>
    <button class="chip" data-tag="primo">primo</button>
    <button class="chip" data-tag="secondo">secondo</button>
    <button class="chip" data-tag="vegetariano">vegetariano</button>
    <button class="chip" data-tag="veloce">veloce</button>
  </nav>

  <section class="row">
    <div style="flex:1 1 520px">
      <label for="ingredients">Generatore antispreco</label>
      <textarea id="ingredients" rows="3" style="width:100%;border:1px solid #ddd;border-radius:10px;padding:10px" placeholder="Scrivi ingredienti separati da virgola o a capo"></textarea>
    </div>
    <div style="align-self:flex-end">
      <button class="btn blue" id="btn-suggest">Suggerisci ricette</button>
    </div>
  </section>

  <section class="cam">
    <h3>Fotocamera OCR</h3>
    <div class="row">
      <button class="btn" id="cam-open">Apri fotocamera</button>
      <button class="btn" id="cam-shot" disabled>Scatta</button>
      <button class="btn" id="cam-close" disabled>Chiudi</button>
      <select id="cam-dev"></select>
      <input type="file" id="cam-file" accept="image/*">
    </div>
    <div class="row" style="gap:20px">
      <video id="cam-video" playsinline muted></video>
      <canvas id="cam-canvas" width="520" height="280"></canvas>
    </div>
    <p class="muted">Il testo riconosciuto sarà aggiunto al box ingredienti. OCR leggero, placeholder.</p>
  </section>
</header>

<main>
  <section id="recipes" class="grid"></section>
</main>

<footer>
  <small>Zero sprechi, più idee in cucina. <span id="build"></span></small>
</footer>

<!-- Modale video -->
<div id="video-modal" class="vm" aria-hidden="true">
  <div class="bg vm-backdrop"></div>
  <div class="box">
    <div class="inner">
      <button id="video-close" class="close" title="Chiudi">Chiudi</button>
      <iframe id="yt-frame"
              src="about:blank"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerpolicy="strict-origin-when-cross-origin"
              allowfullscreen>
      </iframe>
    </div>
  </div>
</div>

<script>window.APP_VERSION='16.9'</script>
<script src="./script/app_v16.js?v=16.9" defer></script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js?v=16.9').catch(()=>{})
    })
  }
</script>
</body>
</html>
