<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Riquadro Codice Copiabile • Ricette & Lista Spesa</title>
  <style>
    :root {
      --bg: #0b0f14;
      --card: #0f1520;
      --muted: #a3b3c2;
      --text: #e6edf3;
      --accent: #22c55e;
      --accent-2: #60a5fa;
      --border: #1f2a37;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace
    }
    html, body { height: 100% }
    body {
      margin: 0;
      background: radial-gradient(1200px 800px at 80% -10%, rgba(34,197,94,.10), transparent 60%),
                  radial-gradient(1000px 700px at -10% 20%, rgba(96,165,250,.10), transparent 55%),
                  var(--bg);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"
    }
    .wrap { max-width: 1100px; margin: 24px auto; padding: 0 16px }

    .code-card {
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0))
                  , var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      margin: 20px 0
    }
    .code-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background: rgba(255,255,255,.02);
      border-bottom: 1px solid var(--border)
    }
    .file {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--muted)
    }
    .file .dot { width: 10px; height: 10px; border-radius: 999px; background: var(--accent) }

    .btns { display: inline-flex; gap: 8px }
    .btn {
      font: inherit;
      color: var(--text);
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 6px 10px;
      cursor: pointer
    }
    .btn:hover { border-color: #2b3a49 }
    .btn.small { padding: 4px 8px; font-size: 12px }

    pre { margin: 0 }
    code {
      display: block;
      padding: 14px;
      line-height: 1.55;
      font-size: 14px;
      font-family: var(--mono);
      color: #d1dee8;
      overflow-x: auto
    }
    .lang-tag {
      position: absolute; right: 12px; top: 12px;
      font-size: 12px; color: var(--muted); background: rgba(255,255,255,.03);
      border: 1px solid var(--border); border-radius: 8px; padding: 2px 8px
    }
    .code-body { position: relative }
  </style>
</head>
<body>
  <div class="wrap">

    <!--
      COME USARE
      1. Copia <style> nel tuo index.html oppure in styles.css
      2. Copia lo <script> in fondo al body oppure in app.v16.js
      3. Per ogni file che devo fornirti, userò questo stesso markup .code-card
      4. Nel tuo progetto, puoi clonare il blocco .code-card e incollare il contenuto tra <code>...</code>
    -->

    <h1 style="font-size:22px; font-weight:700; margin: 0 0 6px 0">Riquadro codice copiabile</h1>
    <p style="margin:0; color:var(--muted)">Pronto da incollare nel progetto Ricette & Lista Spesa</p>

    <!-- ESEMPIO 1: index.html minimal per l'app -->
    <section class="code-card" data-filename="index.html" data-language="html">
      <div class="code-head">
        <div class="file"><span class="dot"></span><span class="name">index.html</span></div>
        <div class="btns">
          <button class="btn small" data-copy>CopiA</button>
          <button class="btn small" data-download>Scarica</button>
        </div>
      </div>
      <div class="code-body">
        <span class="lang-tag">HTML</span>
        <pre><code>&lt;!doctype html&gt;
&lt;html lang="it"&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
  &lt;title&gt;Ricette &amp; Lista Spesa&lt;/title&gt;
  &lt;link rel="stylesheet" href="styles.css"&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="app"&gt;&lt;/div&gt;
  &lt;script src="app.v16.js" defer&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
      </div>
    </section>

    <!-- ESEMPIO 2: app.v16.js placeholder -->
    <section class="code-card" data-filename="app.v16.js" data-language="javascript">
      <div class="code-head">
        <div class="file"><span class="dot" style="background: var(--accent-2)"></span><span class="name">app.v16.js</span></div>
        <div class="btns">
          <button class="btn small" data-copy>CopiA</button>
          <button class="btn small" data-download>Scarica</button>
        </div>
      </div>
      <div class="code-body">
        <span class="lang-tag">JS</span>
        <pre><code>const el = document.getElementById("app")
const state = { ready: true }

function render() {
  el.innerHTML = `\n    &lt;main class="container"&gt;\n      &lt;h1&gt;Ricette &amp; Lista Spesa&lt;/h1&gt;\n      &lt;p&gt;Bootstrap v16 attivo&lt;/p&gt;\n    &lt;/main&gt;\n  `
}

render()</code></pre>
      </div>
    </section>

    <!-- FILE 1: index.html completo -->
    <section class="code-card" data-filename="index.html" data-language="html">
      <div class="code-head">
        <div class="file"><span class="dot"></span><span class="name">index.html</span></div>
        <div class="btns">
          <button class="btn small" data-copy>CopiA</button>
          <button class="btn small" data-download>Scarica</button>
        </div>
      </div>
      <div class="code-body">
        <span class="lang-tag">HTML</span>
        <pre><code>&lt;!doctype html&gt;
&lt;html lang="it"&gt;
&lt;head&gt;
  &lt;meta charset="utf-8" /&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;
  &lt;title&gt;Ricette &amp; Lista Spesa&lt;/title&gt;
  &lt;meta name="description" content="Ricette, lista spesa, suggerimenti per ingredienti, video, OCR e camera." /&gt;
  &lt;meta name="theme-color" content="#0f172a" /&gt;
  &lt;link rel="manifest" href="manifest.webmanifest" /&gt;
  &lt;link rel="stylesheet" href="styles.css" /&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;header class="topbar"&gt;
    &lt;h1&gt;Ricette &amp; Lista Spesa&lt;/h1&gt;
    &lt;nav class="actions"&gt;
      &lt;button id="btn-refresh" class="btn" title="Aggiorna dataset"&gt;Aggiorna dati&lt;/button&gt;
      &lt;button id="btn-backup" class="btn outline" title="Backup manuale"&gt;Backup&lt;/button&gt;
    &lt;/nav&gt;
  &lt;/header&gt;

  &lt;main class="container"&gt;
    &lt;section class="panel"&gt;
      &lt;h2&gt;Filtri&lt;/h2&gt;
      &lt;div id="chip-tags" class="chips" aria-label="Filtri tag"&gt;&lt;/div&gt;
      &lt;div class="row" style="gap:8px;margin-top:10px"&gt;
        &lt;input id="search" class="input" placeholder="Cerca titolo o ingrediente" /&gt;
        &lt;button id="clear" class="btn"&gt;Pulisci&lt;/button&gt;
      &lt;/div&gt;
      &lt;label class="tiny"&gt;Logica filtri: AND tra i tag selezionati.&lt;/label&gt;
    &lt;/section&gt;

    &lt;section class="panel"&gt;
      &lt;h2&gt;Suggerisci ricette&lt;/h2&gt;
      &lt;div class="row" style="gap:8px"&gt;
        &lt;input id="ing-input" class="input" placeholder="Inserisci ingredienti separati da virgola" /&gt;
        &lt;button id="btn-suggerisci" class="btn"&gt;Suggerisci&lt;/button&gt;
      &lt;/div&gt;
      &lt;div id="suggerimenti" class="cards"&gt;&lt;/div&gt;
    &lt;/section&gt;

    &lt;section class="panel"&gt;
      &lt;h2&gt;Ricette&lt;/h2&gt;
      &lt;div id="recipes" class="cards"&gt;&lt;/div&gt;
    &lt;/section&gt;

    &lt;section class="panel"&gt;
      &lt;h2&gt;Camera e OCR&lt;/h2&gt;
      &lt;div class="row wrap" style="gap:8px"&gt;
        &lt;button id="cam-open" class="btn"&gt;Apri camera&lt;/button&gt;
        &lt;button id="cam-close" class="btn outline"&gt;Chiudi camera&lt;/button&gt;
        &lt;button id="cam-capture" class="btn"&gt;Cattura&lt;/button&gt;
        &lt;input id="file-input" type="file" accept="image/*" hidden /&gt;
        &lt;button id="btn-upload" class="btn"&gt;Carica immagine&lt;/button&gt;
        &lt;div class="drop" id="drop"&gt;Trascina una foto qui&lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="cam-wrap"&gt;
        &lt;video id="video" playsinline muted&gt;&lt;/video&gt;
        &lt;canvas id="canvas"&gt;&lt;/canvas&gt;
      &lt;/div&gt;
      &lt;pre id="ocr-out" class="pre"&gt;&lt;/pre&gt;
    &lt;/section&gt;
  &lt;/main&gt;

  &lt;dialog id="video-modal" class="modal"&gt;
    &lt;div class="modal-body"&gt;
      &lt;header class="modal-head"&gt;
        &lt;strong&gt;Video ricetta&lt;/strong&gt;
        &lt;button id="video-close" class="btn small"&gt;Chiudi&lt;/button&gt;
      &lt;/header&gt;
      &lt;div class="ratio" id="video-embed"&gt;&lt;/div&gt;
    &lt;/div&gt;
  &lt;/dialog&gt;

  &lt;script src="app.v16.js" defer&gt;&lt;/script&gt;
  &lt;script&gt;
    // Registrazione SW con opzioni test: ?sw=off per disattivare temporaneamente
    (function(){
      const qs = new URLSearchParams(location.search)
      if ('serviceWorker' in navigator) {
        if (qs.get('sw') === 'off') {
          navigator.serviceWorker.getRegistrations().then(list =&gt; {
            list.forEach(r =&gt; r.unregister())
          })
          console.info('Service Worker disattivato per questa sessione')
        } else {
          navigator.serviceWorker.register('service-worker.js')
            .catch(err =&gt; console.warn('SW non registrato', err))
        }
      }
    })();
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
      </div>
    </section>

    <!-- FILE 2: styles.css -->
    <section class="code-card" data-filename="styles.css" data-language="css">
      <div class="code-head">
        <div class="file"><span class="dot" style="background: var(--accent-2)"></span><span class="name">styles.css</span></div>
        <div class="btns">
          <button class="btn small" data-copy>CopiA</button>
          <button class="btn small" data-download>Scarica</button>
        </div>
      </div>
      <div class="code-body">
        <span class="lang-tag">CSS</span>
        <pre><code>:root{--bg:#0b0f14;--card:#0f1520;--muted:#a3b3c2;--text:#e6edf3;--accent:#22c55e;--border:#1f2a37;--gap:12px}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--border);background:#0c1220;position:sticky;top:0;z-index:5}
.container{max-width:1100px;margin:20px auto;padding:0 16px}
.panel{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin:14px 0}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{border:1px solid var(--border);border-radius:999px;padding:6px 10px;font-size:13px;color:var(--muted);cursor:pointer}
.chip.active{background:rgba(34,197,94,.15);color:#d7ffe7;border-color:#185b37}
.input{flex:1;min-width:180px;background:#0c1220;border:1px solid var(--border);color:var(--text);padding:8px 10px;border-radius:10px}
.btn{background:#162232;border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:10px;cursor:pointer}
.btn.small{padding:4px 8px;font-size:12px}
.btn.outline{background:transparent}
.row{display:flex;align-items:center}
.wrap{flex-wrap:wrap}
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:var(--gap)}
.card{background:#0c1220;border:1px solid var(--border);border-radius:12px;overflow:hidden}
.card .media{aspect-ratio:16/9;background:#0a0f18;display:grid;place-items:center;color:#6c7b8a;font-size:12px}
.card img{width:100%;height:100%;object-fit:cover}
.card .body{padding:10px}
.card h3{margin:0 0 6px 0;font-size:16px}
.tiny{color:var(--muted);font-size:12px}
.modal{border:none;padding:0;background:transparent}
.modal::backdrop{background:rgba(0,0,0,.6)}
.modal-body{width:min(960px,92vw);background:#0c1220;border:1px solid var(--border);border-radius:12px;overflow:hidden}
.modal-head{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid var(--border)}
.ratio{position:relative;width:100%;aspect-ratio:16/9}
.ratio iframe{position:absolute;inset:0;width:100%;height:100%}
.cam-wrap{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
video,canvas{width:100%;background:#000;border-radius:10px}
.drop{border:1px dashed var(--border);border-radius:10px;padding:10px;text-align:center;color:var(--muted)}
.pre{background:#0a0f18;border:1px solid var(--border);border-radius:10px;padding:10px;white-space:pre-wrap}
.hidden{display:none}
</code></pre>
      </div>
    </section>

    <!-- FILE 3: app.v16.js -->
    <section class="code-card" data-filename="app.v16.js" data-language="javascript">
      <div class="code-head">
        <div class="file"><span class="dot" style="background: var(--accent)"></span><span class="name">app.v16.js</span></div>
        <div class="btns">
          <button class="btn small" data-copy>CopiA</button>
          <button class="btn small" data-download>Scarica</button>
        </div>
      </div>
      <div class="code-body">
        <span class="lang-tag">JS</span>
        <pre><code>/* Ricette &amp; Lista Spesa - v16 core */
const state = {
  all: [], // ricette
  tags: new Set(),
  activeTags: new Set(),
  filtered: [],
  suggerite: [],
  mediaStream: null,
  backupPending: false
}

const els = {
  chips: document.getElementById('chip-tags'),
  recipes: document.getElementById('recipes'),
  search: document.getElementById('search'),
  clear: document.getElementById('clear'),
  suggerimenti: document.getElementById('suggerimenti'),
  ingInput: document.getElementById('ing-input'),
  btnSuggerisci: document.getElementById('btn-suggerisci'),
  btnRefresh: document.getElementById('btn-refresh'),
  btnBackup: document.getElementById('btn-backup'),
  // camera
  camOpen: document.getElementById('cam-open'),
  camClose: document.getElementById('cam-close'),
  camCapture: document.getElementById('cam-capture'),
  video: document.getElementById('video'),
  canvas: document.getElementById('canvas'),
  drop: document.getElementById('drop'),
  fileInput: document.getElementById('file-input'),
  ocrOut: document.getElementById('ocr-out'),
  // video modal
  modal: document.getElementById('video-modal'),
  modalClose: document.getElementById('video-close'),
  modalEmbed: document.getElementById('video-embed')
}

const DATA_URL = 'assets/json/recipes-it.json' // usa questo percorso; in fallback usa DEMO_DATA
const FALLBACK_IMAGE = 'assets/icons/recipe-fallback.svg' // inserisci un svg semplice oppure lasciare assente: gestito via &lt;div class="media"&gt;

const DEMO_DATA = [
  { id: 1, title: 'Pasta al tonno', tags: ['pasta','pesce'], ingredients: ['pasta','tonno','pomodoro'], image: '', videoId: 'dQw4w9WgXcQ' },
  { id: 2, title: 'Insalata mista', tags: ['insalata','veg'], ingredients: ['insalata','pomodoro','olio'], image: '', videoId: '' },
  { id: 3, title: 'Tiramisù', tags: ['dolce'], ingredients: ['mascarpone','savoiardi','caffè'], image: '', videoId: '' }
]

async function loadData() {
  try {
    const res = await fetch(DATA_URL, { cache: 'no-store' })
    if (!res.ok) throw new Error('HTTP '+res.status)
    const data = await res.json()
    initData(Array.isArray(data) ? data : (data.recipes || []))
  } catch (e) {
    console.warn('Dataset non disponibile, uso DEMO', e)
    initData(DEMO_DATA)
  }
}

function initData(recipes) {
  state.all = recipes
  state.tags = new Set(recipes.flatMap(r =&gt; r.tags || []))
  renderChips()
  applyFilters()
}

function renderChips() {
  els.chips.innerHTML = ''
  Array.from(state.tags).sort().forEach(tag =&gt; {
    const b = document.createElement('button')
    b.className = 'chip'
    b.textContent = tag
    b.addEventListener('click', () =&gt; {
      if (state.activeTags.has(tag)) state.activeTags.delete(tag); else state.activeTags.add(tag)
      b.classList.toggle('active')
      applyFilters()
    })
    els.chips.appendChild(b)
  })
}

function applyFilters() {
  const q = (els.search.value || '').toLowerCase().trim()
  const must = Array.from(state.activeTags)
  state.filtered = state.all.filter(r =&gt; {
    // AND tra tag selezionati
    const tagsOk = must.every(t =&gt; (r.tags || []).includes(t))
    if (!tagsOk) return false
    if (!q) return true
    const hay = [r.title, ...(r.ingredients||[]), ...(r.tags||[])].join(' ').toLowerCase()
    return hay.includes(q)
  })
  renderRecipes()
}

function recipeCard(r) {
  const hasImg = Boolean(r.image)
  const imgHtml = hasImg ? `&lt;img src="${r.image}" alt="${r.title}" onerror="this.replaceWith(document.createElement('div'))"&gt;` : ''
  const tags = (r.tags || []).map(t =&gt; `&lt;span class="tiny"&gt;#${t}&lt;/span&gt;`).join(' ')
  const btnVideo = r.videoId ? `&lt;button class="btn small" data-video="${r.videoId}"&gt;Guarda video&lt;/button&gt;` : ''
  return `
    &lt;article class="card"&gt;
      &lt;div class="media"&gt;${hasImg ? imgHtml : 'Nessuna immagine'}&lt;/div&gt;
      &lt;div class="body"&gt;
        &lt;h3&gt;${r.title}&lt;/h3&gt;
        &lt;div class="tiny"&gt;${tags}&lt;/div&gt;
        &lt;div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap"&gt;
          ${btnVideo}
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/article&gt;`
}

function renderRecipes() {
  els.recipes.innerHTML = state.filtered.map(recipeCard).join('')
  // wire video buttons
  els.recipes.querySelectorAll('[data-video]').forEach(btn =&gt; btn.addEventListener('click', () =&gt; openVideo(btn.getAttribute('data-video'))))
}

function rankByIngredients(input) {
  const have = input.split(',').map(s =&gt; s.trim().toLowerCase()).filter(Boolean)
  const scored = state.all.map(r =&gt; {
    const ing = (r.ingredients || []).map(x =&gt; x.toLowerCase())
    const overlap = have.filter(x =&gt; ing.includes(x)).length
    const score = overlap / Math.max(1, ing.length)
    return { r, score, overlap }
  }).filter(x =&gt; x.overlap &gt; 0)
  scored.sort((a,b) =&gt; b.score - a.score || b.overlap - a.overlap)
  state.suggerite = scored.map(x =&gt; x.r)
}

function renderSuggerite() {
  els.suggerimenti.innerHTML = state.suggerite.map(recipeCard).join('')
  els.suggerimenti.querySelectorAll('[data-video]').forEach(btn =&gt; btn.addEventListener('click', () =&gt; openVideo(btn.getAttribute('data-video'))))
}

// Video modal con nocookie e fallback 2s
function openVideo(videoId) {
  if (!videoId) return
  els.modal.showModal()
  els.modalEmbed.innerHTML = ''
  let loaded = false
  const iframe = document.createElement('iframe')
  iframe.src = `https://www.youtube-nocookie.com/embed/${videoId}?rel=0`
  iframe.title = 'YouTube video'
  iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share'
  iframe.referrerPolicy = 'strict-origin-when-cross-origin'
  iframe.onload = () =&gt; { loaded = true }
  els.modalEmbed.appendChild(iframe)
  setTimeout(() =&gt; {
    if (!loaded) {
      window.open(`https://www.youtube.com/watch?v=${videoId}`, '_blank')
    }
  }, 2000)
}

els.modalClose.addEventListener('click', () =&gt; els.modal.close())

// Camera + OCR placeholder
async function openCamera() {
  try {
    state.mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false })
    els.video.srcObject = state.mediaStream
    await els.video.play()
  } catch (e) {
    alert('Camera non disponibile')
  }
}
function closeCamera() {
  if (state.mediaStream) state.mediaStream.getTracks().forEach(t =&gt; t.stop())
  els.video.srcObject = null
}
function captureFrame() {
  const w = els.video.videoWidth || 640
  const h = els.video.videoHeight || 360
  els.canvas.width = w
  els.canvas.height = h
  const ctx = els.canvas.getContext('2d')
  ctx.drawImage(els.video, 0, 0, w, h)
  // OCR placeholder
  fakeOCR(els.canvas).then(text =&gt; {
    els.ocrOut.textContent = text
  })
}
function fakeOCR(canvas) {
  return new Promise(res =&gt; setTimeout(() =&gt; res('OCR di prova completato. Testo non letto, pipeline placeholder.'), 400))
}

function handleFiles(files) {
  const f = files[0]
  if (!f) return
  const img = new Image()
  const url = URL.createObjectURL(f)
  img.onload = () =&gt; {
    const w = img.naturalWidth, h = img.naturalHeight
    els.canvas.width = w; els.canvas.height = h
    const ctx = els.canvas.getContext('2d')
    ctx.drawImage(img, 0, 0)
    URL.revokeObjectURL(url)
    fakeOCR(els.canvas).then(t =&gt; els.ocrOut.textContent = t)
  }
  img.src = url
}

// Backup manuale: chiede conferma alle 00 prima di avviare
function scheduleMidnightPrompt() {
  const now = new Date()
  const next = new Date(now)
  next.setHours(24,0,0,0)
  const ms = next - now
  setTimeout(() =&gt; {
    const go = confirm('Avviare backup manuale adesso?')
    if (go) runBackup(); else console.info('Backup saltato su scelta utente')
    scheduleMidnightPrompt()
  }, ms)
}
function runBackup() {
  // Qui inserisci la tua logica di backup manuale
  alert('Backup avviato')
}

// Event wiring
els.search.addEventListener('input', applyFilters)
els.clear.addEventListener('click', () =&gt; { els.search.value = ''; state.activeTags.clear(); renderChips(); applyFilters() })
els.btnSuggerisci.addEventListener('click', () =&gt; { rankByIngredients(els.ingInput.value); renderSuggerite() })
els.btnRefresh.addEventListener('click', () =&gt; loadData())
els.btnBackup.addEventListener('click', runBackup)

els.camOpen.addEventListener('click', openCamera)
els.camClose.addEventListener('click', closeCamera)
els.camCapture.addEventListener('click', captureFrame)

els.drop.addEventListener('dragover', e =&gt; { e.preventDefault(); els.drop.style.opacity = .8 })
els.drop.addEventListener('dragleave', () =&gt; { els.drop.style.opacity = 1 })
els.drop.addEventListener('drop', e =&gt; { e.preventDefault(); els.drop.style.opacity = 1; handleFiles(e.dataTransfer.files) })

els.fileInput.addEventListener('change', e =&gt; handleFiles(e.target.files))

document.getElementById('btn-upload').addEventListener('click', () =&gt; els.fileInput.click())

// Init
loadData()
scheduleMidnightPrompt()
</code></pre>
      </div>
    </section>

    <!-- FILE 4: service-worker.js -->
    <section class="code-card" data-filename="service-worker.js" data-language="javascript">
      <div class="code-head">
        <div class="file"><span class="dot"></span><span class="name">service-worker.js</span></div>
        <div class="btns">
          <button class="btn small" data-copy>CopiA</button>
          <button class="btn small" data-download>Scarica</button>
        </div>
      </div>
      <div class="code-body">
        <span class="lang-tag">JS</span>
        <pre><code>/* SW v16: cache shell con bypass per test. Usa ?sw=off per disattivare */
const V = 'v16.0.0'
const APP_SHELL = [
  '/',
  '/index.html',
  '/styles.css',
  '/app.v16.js'
]
self.addEventListener('install', e =&gt; {
  e.waitUntil(caches.open(V).then(c =&gt; c.addAll(APP_SHELL)).then(() =&gt; self.skipWaiting()))
})
self.addEventListener('activate', e =&gt; {
  e.waitUntil(caches.keys().then(keys =&gt; Promise.all(keys.filter(k =&gt; k !== V).map(k =&gt; caches.delete(k))))
    .then(() =&gt; self.clients.claim()))
})
self.addEventListener('fetch', e =&gt; {
  const url = new URL(e.request.url)
  if (e.request.method !== 'GET') return
  // no-cache per dataset
  if (url.pathname.endsWith('/assets/json/recipes-it.json')) return
  e.respondWith(
    caches.match(e.request).then(hit =&gt; hit || fetch(e.request).then(res =&gt; {
      const copy = res.clone()
      caches.open(V).then(c =&gt; c.put(e.request, copy))
      return res
    }).catch(() =&gt; hit))
  )
})
</code></pre>
      </div>
    </section>

    <!-- FILE 5: manifest.webmanifest -->
    <section class="code-card" data-filename="manifest.webmanifest" data-language="json">
      <div class="code-head">
        <div class="file"><span class="dot" style="background: var(--accent-2)"></span><span class="name">manifest.webmanifest</span></div>
        <div class="btns">
          <button class="btn small" data-copy>CopiA</button>
          <button class="btn small" data-download>Scarica</button>
        </div>
      </div>
      <div class="code-body">
        <span class="lang-tag">JSON</span>
        <pre><code>{
  "name": "Ricette & Lista Spesa",
  "short_name": "Ricette",
  "start_url": "/index.html",
  "display": "standalone",
  "background_color": "#0b0f14",
  "theme_color": "#0f172a",
  "description": "Ricette, lista spesa, suggerimenti ingredienti, video, OCR e camera.",
  "icons": []
}
</code></pre>
      </div>
    </section>

    <!-- FILE 6: assets/json/recipes-it.json (esempio) -->
    <section class="code-card" data-filename="assets/json/recipes-it.json" data-language="json">
      <div class="code-head">
        <div class="file"><span class="dot"></span><span class="name">assets/json/recipes-it.json</span></div>
        <div class="btns">
          <button class="btn small" data-copy>CopiA</button>
          <button class="btn small" data-download>Scarica</button>
        </div>
      </div>
      <div class="code-body">
        <span class="lang-tag">JSON</span>
        <pre><code>[
  { "id": 1, "title": "Pasta al tonno", "tags": ["pasta","pesce"], "ingredients": ["pasta","tonno","pomodoro"], "image": "", "videoId": "" },
  { "id": 2, "title": "Spaghetti aglio olio", "tags": ["pasta","veg"], "ingredients": ["spaghetti","aglio","olio","peperoncino"], "image": "", "videoId": "" },
  { "id": 3, "title": "Pasta e patate", "tags": ["pasta"], "ingredients": ["pasta","patate","cipolla"], "image": "", "videoId": "" },
  { "id": 4, "title": "Insalata mista", "tags": ["insalata","veg"], "ingredients": ["insalata","pomodoro","olio"], "image": "", "videoId": "" },
  { "id": 5, "title": "Frittata di zucchine", "tags": ["uova","secondo"], "ingredients": ["uova","zucchine","parmigiano"], "image": "", "videoId": "" },
  { "id": 6, "title": "Pollo al limone", "tags": ["carne","secondo"], "ingredients": ["pollo","limone","olio"], "image": "", "videoId": "" },
  { "id": 7, "title": "Minestrone", "tags": ["zuppa","veg"], "ingredients": ["verdure","brodo","olio"], "image": "", "videoId": "" },
  { "id": 8, "title": "Tiramisù", "tags": ["dolce"], "ingredients": ["mascarpone","savoiardi","caffè"], "image": "", "videoId": "" },
  { "id": 9, "title": "Bruschette", "tags": ["antipasto","veg"], "ingredients": ["pane","pomodoro","olio","basilico"], "image": "", "videoId": "" },
  { "id": 10, "title": "Riso al curry", "tags": ["riso"], "ingredients": ["riso","curry","cipolla"], "image": "", "videoId": "" }
]
</code></pre>
      </div>
    </section>

    <!-- FILE 7: assets/icons/recipe-fallback.svg -->
    <section class="code-card" data-filename="assets/icons/recipe-fallback.svg" data-language="xml">
      <div class="code-head">
        <div class="file"><span class="dot"></span><span class="name">assets/icons/recipe-fallback.svg</span></div>
        <div class="btns">
          <button class="btn small" data-copy>CopiA</button>
          <button class="btn small" data-download>Scarica</button>
        </div>
      </div>
      <div class="code-body">
        <span class="lang-tag">SVG</span>
        <pre><code><?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" fill="none">
  <rect width="64" height="64" rx="12" fill="#0c1220"/>
  <path d="M20 24h24M20 32h24M20 40h14" stroke="#a3b3c2" stroke-width="3" stroke-linecap="round"/>
  <circle cx="46" cy="40" r="6" stroke="#22c55e" stroke-width="3"/>
</svg>
</code></pre>
      </div>
    </section>

  </div>

  <script>
    // Logica bottone Copia e Scarica per ogni riquadro
    function wireCodeCards() {
      const cards = document.querySelectorAll('.code-card')
      cards.forEach(card => {
        const codeEl = card.querySelector('code')
        const btnCopy = card.querySelector('[data-copy]')
        const btnDownload = card.querySelector('[data-download]')
        const filename = card.getAttribute('data-filename') || 'snippet.txt'

        btnCopy?.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(codeEl.innerText)
            btnCopy.textContent = 'Copiato'
            setTimeout(() => btnCopy.textContent = 'CopiA', 1200)
          } catch (e) {
            console.warn('Clipboard non disponibile')
            const r = document.createRange()
            r.selectNodeContents(codeEl)
            const sel = window.getSelection()
            sel.removeAllRanges()
            sel.addRange(r)
          }
        })

        btnDownload?.addEventListener('click', () => {
          const blob = new Blob([codeEl.innerText], { type: 'text/plain;charset=utf-8' })
          const url = URL.createObjectURL(blob)
          const a = document.createElement('a')
          a.href = url
          a.download = filename
          document.body.appendChild(a)
          a.click()
          a.remove()
          URL.revokeObjectURL(url)
        })
      })
    }

    document.addEventListener('DOMContentLoaded', wireCodeCards)
  </script>
</body>
</html>
