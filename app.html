<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App demo · Ricette & Lista Spesa</title>

  <!-- PWA base, percorsi relativi -->
  <meta name="theme-color" content="#10b981" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="favicon.ico" />

  <!-- Plausible opzionale -->
  <script defer data-domain="salvatore251086.github.io/ricette-lista-spesa"
          data-api="https://plausible.io/api/event"
          src="https://plausible.io/js/script.js"></script>
  <script>window.plausible = window.plausible || function(){(plausible.q = plausible.q || []).push(arguments)}</script>

  <style>
    :root{
      --brand:#10b981;
      --ink:#0f172a;
      --muted:#475569;
      --card:#f8fafc;
      --ring:rgba(16,185,129,.55);
      --accent:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;color:var(--ink);background:#fff;line-height:1.6}
    header,main,footer{max-width:1100px;margin:0 auto;padding:0 1rem}
    a{text-decoration:none;color:inherit}
    img{max-width:100%;height:auto}
    /* Nav */
    .topbar{display:flex;align-items:center;gap:.75rem;height:64px}
    .brand{display:flex;align-items:center;gap:.5rem;font-weight:800}
    .brand img{width:32px;height:32px}
    .grow{flex:1}
    .nav{display:flex;gap:.5rem;flex-wrap:wrap}
    .nav a{padding:.5rem .75rem;border-radius:.6rem;color:var(--muted)}
    .nav a.active{background:var(--card);border:1px solid #e2e8f0;color:var(--ink)}
    .cta{display:flex;gap:.5rem}
    .btn{appearance:none;border:0;border-radius:.75rem;padding:.65rem 1rem;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:.5rem}
    .btn-primary{background:var(--brand);color:#fff}
    .btn-outline{background:#fff;border:2px solid var(--brand);color:var(--brand)}
    .btn-ghost{background:#f1f5f9;color:#0f172a}
    .btn:focus{outline:3px solid var(--ring);outline-offset:2px}

    /* Layout */
    .hero{margin:1rem 0 1.25rem;padding:1rem;border-radius:1rem;background:var(--card);border:1px solid #e2e8f0}
    .grid{display:grid;gap:1rem}
    @media (min-width:800px){ .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))} }
    @media (max-width:799px){ .grid-3{grid-template-columns:1fr} }
    .card{background:#fff;border:1px solid #e2e8f0;border-radius:1rem;overflow:hidden}
    .card .body{padding:1rem}
    .pill{display:inline-block;font-size:.8rem;padding:.15rem .5rem;border-radius:999px;background:#fff3; color:#111}
    .muted{color:var(--muted)}
    .tag{display:inline-block;background:#fff7ed;border:1px solid #fed7aa;color:#7c2d12;padding:.15rem .5rem;border-radius:.5rem;font-size:.8rem}

    /* Forms */
    .row{display:flex;gap:.5rem;flex-wrap:wrap;margin:.5rem 0}
    .input{flex:1 1 220px;padding:.65rem .75rem;border:1px solid #cbd5e1;border-radius:.65rem}
    .textarea{width:100%;min-height:110px;padding:.75rem;border:1px solid #cbd5e1;border-radius:.65rem;resize:vertical}
    label{font-weight:600;margin:.25rem 0 .25rem;display:block}

    /* Recipe list */
    .recipe{display:flex;gap:.75rem;align-items:flex-start}
    .thumb{width:84px;height:84px;border-radius:.75rem;border:1px solid #e2e8f0;background:#fff;display:grid;place-items:center;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .actions{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.5rem}
    .badge{display:inline-flex;align-items:center;gap:.25rem;font-size:.85rem;background:#ecfeff;border:1px solid #a5f3fc;color:#155e75;border-radius:.5rem;padding:.15rem .4rem}
    footer{margin:2rem 0 3rem;color:var(--muted);font-size:.95rem}
    .hidden{display:none}
    .sr{position:absolute;left:-9999px}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <a href="#/" class="brand">
        <img src="assets/icons/icon-192.png" alt="Logo" />
        <span>Ricette & Lista Spesa</span>
      </a>
      <div class="grow"></div>
      <nav class="nav" id="mainNav">
        <a href="#/" data-route="/">Home</a>
        <a href="#/generator" data-route="/generator">Generatore</a>
        <a href="#/saved" data-route="/saved">Salvate</a>
      </nav>
      <div class="cta">
        <button id="installBtn" class="btn btn-primary hidden">Installa</button>
        <a class="btn btn-outline" href="https://whatsapp.com/channel/0029Vb6la2aCHDycDs8wsn2h" target="_blank" rel="noopener">WhatsApp</a>
      </div>
    </div>
  </header>

  <main id="app">
    <!-- contenuto iniettato via router -->
  </main>

  <footer>
    © 2025 Ricette & Lista Spesa — Demo
  </footer>

  <script>
    // Mock ricette
    const MOCK_RECIPES = [
      {
        id: 'r1',
        title: 'Pasta al pomodoro veloce',
        img: 'assets/icons/icon-512.png',
        time: 15,
        cost: '€',
        tags: ['veloce','economica'],
        ingredients: ['pasta','pomodoro','aglio','olio','sale'],
        steps: [
          'Metti a bollire l’acqua e sala',
          'Soffriggi aglio in olio, aggiungi pomodoro',
          'Cuoci la pasta, manteca con il sugo'
        ]
      },
      {
        id: 'r2',
        title: 'Frittata svuota frigo',
        img: 'assets/icons/icon-512.png',
        time: 10,
        cost: '€',
        tags: ['antispreco','proteica'],
        ingredients: ['uova','formaggio','verdure','sale','pepe'],
        steps: [
          'Sbatti uova con sale e pepe',
          'Aggiungi verdure e formaggio',
          'Cuoci in padella 6 minuti'
        ]
      },
      {
        id: 'r3',
        title: 'Insalata di ceci e tonno',
        img: 'assets/icons/icon-512.png',
        time: 7,
        cost: '€',
        tags: ['fredda','senza fornelli'],
        ingredients: ['ceci','tonno','olio','limone','sale'],
        steps: [
          'Scola ceci e tonno',
          'Condisci con olio e limone',
          'Regola di sale'
        ]
      }
    ];

    // Storage
    const SAVED_KEY = 'demo_saved_recipes';
    const saved = new Set(JSON.parse(localStorage.getItem(SAVED_KEY) || '[]'));
    function persistSaved(){
      localStorage.setItem(SAVED_KEY, JSON.stringify([...saved]));
    }

    // Router
    const routes = {
      '/': renderHome,
      '/generator': renderGenerator,
      '/saved': renderSaved,
      '/recipe': renderRecipeDetail
    };

    function setActiveNav(path){
      document.querySelectorAll('#mainNav a').forEach(a=>{
        a.classList.toggle('active', a.getAttribute('href') === '#'+path);
      });
    }

    function navigate(){
      const hash = location.hash || '#/';
      const [_, rawPath, ...rest] = hash.split('/');
      const path = '/'+(rawPath || '');
      setActiveNav(path);

      if (path === '/recipe' && rest[0]) {
        const id = rest[0];
        routes['/recipe'](id);
        return;
      }

      const handler = routes[path] || routes['/'];
      handler();
    }
    window.addEventListener('hashchange', navigate);

    // Views
    function renderHome(){
      const el = document.getElementById('app');
      el.innerHTML = `
        <section class="hero">
          <h1>Ricette smart in base a ciò che hai</h1>
          <p class="muted">Prova il generatore. Salva le preferite. Tutto locale e senza login.</p>
        </section>

        <section>
          <h2>Consigliate oggi</h2>
          <div class="grid grid-3" id="homeList"></div>
        </section>
      `;
      const list = document.getElementById('homeList');
      renderCards(MOCK_RECIPES, list);
      try{ plausible('demo_home_view'); }catch{}
    }

    function renderGenerator(){
      const el = document.getElementById('app');
      el.innerHTML = `
        <section class="card">
          <div class="body">
            <h2>Generatore ricette</h2>
            <p class="muted">Scrivi ingredienti separati da virgola. Esempio: pasta, tonno, pomodoro</p>
            <label for="ing">Ingredienti</label>
            <textarea id="ing" class="textarea" placeholder="es. uova, formaggio, verdure"></textarea>
            <div class="row">
              <button id="genBtn" class="btn btn-primary">Genera</button>
              <button id="clearBtn" class="btn btn-ghost">Pulisci</button>
            </div>
          </div>
        </section>

        <section style="margin-top:1rem">
          <h2>Risultati</h2>
          <div class="grid grid-3" id="genList"></div>
        </section>
      `;
      const ing = document.getElementById('ing');
      const list = document.getElementById('genList');

      function run(){
        const tokens = ing.value.toLowerCase().split(',').map(s=>s.trim()).filter(Boolean);
        const res = tokens.length
          ? MOCK_RECIPES.filter(r => tokens.some(t => r.ingredients.includes(t)))
          : [];
        list.innerHTML = '';
        if (!res.length){
          list.innerHTML = `<p class="muted">Nessun risultato. Aggiungi ingredienti o controlla la grafia.</p>`;
          return;
        }
        renderCards(res, list);
      }

      document.getElementById('genBtn').addEventListener('click', ()=>{
        run();
        try{ plausible('demo_generate_click'); }catch{}
      });
      document.getElementById('clearBtn').addEventListener('click', ()=>{ ing.value=''; list.innerHTML=''; });
      try{ plausible('demo_generator_view'); }catch{}
    }

    function renderSaved(){
      const el = document.getElementById('app');
      el.innerHTML = `
        <section class="hero">
          <h2>Ricette salvate</h2>
          <p class="muted">Restano sul dispositivo.</p>
        </section>
        <section>
          <div class="grid grid-3" id="savedList"></div>
        </section>
      `;
      const list = document.getElementById('savedList');
      const data = MOCK_RECIPES.filter(r => saved.has(r.id));
      if (!data.length){
        list.innerHTML = `<p class="muted">Vuota. Salva dal catalogo o dal generatore.</p>`;
      } else {
        renderCards(data, list);
      }
      try{ plausible('demo_saved_view'); }catch{}
    }

    function renderRecipeDetail(id){
      const rec = MOCK_RECIPES.find(x => x.id === id);
      const el = document.getElementById('app');
      if (!rec){
        el.innerHTML = `<p class="muted">Ricetta non trovata.</p>`;
        return;
      }
      el.innerHTML = `
        <article class="card">
          <div class="body">
            <a href="#/" class="btn btn-ghost">Torna</a>
            <h1 style="margin-top:.5rem">${rec.title}</h1>
            <div class="row">
              <span class="badge">⏱ ${rec.time} min</span>
              <span class="badge">💶 ${rec.cost}</span>
              ${rec.tags.map(t=>`<span class="tag">${t}</span>`).join('')}
            </div>
            <div class="row" style="margin:.75rem 0">
              <div class="thumb"><img src="${rec.img}" alt="${rec.title}"></div>
            </div>
            <h3>Ingredienti</h3>
            <ul>${rec.ingredients.map(i=>`<li>• ${i}</li>`).join('')}</ul>
            <h3>Passi</h3>
            <ol>${rec.steps.map(s=>`<li>${s}</li>`).join('')}</ol>
            <div class="actions">
              <button class="btn btn-primary" id="toggleSave">${saved.has(rec.id) ? 'Rimuovi dai salvati' : 'Salva'}</button>
              <a class="btn btn-outline" href="app.html" target="_self">Apri Lista Spesa</a>
              <a class="btn btn-ghost" href="https://whatsapp.com/channel/0029Vb6la2aCHDycDs8wsn2h" target="_blank" rel="noopener">WhatsApp</a>
            </div>
          </div>
        </article>
      `;
      document.getElementById('toggleSave').addEventListener('click', ()=>{
        if (saved.has(rec.id)) saved.delete(rec.id); else saved.add(rec.id);
        persistSaved();
        location.replace(`#/recipe/${rec.id}`);
      });
      try{ plausible('demo_recipe_view'); }catch{}
    }

    // Helpers
    function renderCards(arr, mount){
      arr.forEach(r=>{
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <div class="body">
            <div class="recipe">
              <div class="thumb"><img src="${r.img}" alt="${r.title}" /></div>
              <div class="grow">
                <a href="#/recipe/${r.id}"><strong>${r.title}</strong></a>
                <div class="row" style="margin:.25rem 0">
                  <span class="badge">⏱ ${r.time} min</span>
                  <span class="badge">💶 ${r.cost}</span>
                  ${r.tags.slice(0,2).map(t=>`<span class="tag">${t}</span>`).join('')}
                </div>
                <div class="actions">
                  <button data-save="${r.id}" class="btn ${saved.has(r.id)?'btn-ghost':'btn-primary'}">
                    ${saved.has(r.id)?'Rimuovi':'Salva'}
                  </button>
                  <a class="btn btn-outline" href="#/recipe/${r.id}">Apri</a>
                </div>
              </div>
            </div>
          </div>
        `;
        mount.appendChild(card);
      });

      mount.querySelectorAll('button[data-save]').forEach(b=>{
        b.addEventListener('click', ()=>{
          const id = b.getAttribute('data-save');
          if (saved.has(id)) saved.delete(id); else saved.add(id);
          persistSaved();
          navigate(); // re-render della vista
        });
      });
    }

    // SW
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(()=>{});
    }

    // Install prompt
    let deferredPrompt = null;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.classList.remove('hidden');
    });
    installBtn?.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      try {
        const r = await deferredPrompt.prompt();
        try{ plausible('demo_install_prompt', {props:{outcome:r.outcome}}); }catch{}
      } catch {}
      deferredPrompt = null;
      installBtn.classList.add('hidden');
    });

    // Avvio
    if (!location.hash) location.hash = '#/';
    navigate();
  </script>
</body>
</html>
