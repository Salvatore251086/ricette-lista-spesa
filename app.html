<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App demo · Ricette & Lista Spesa</title>

  <meta name="theme-color" content="#10b981" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="favicon.ico" />

  <style>
    :root{--brand:#10b981;--ink:#0f172a;--muted:#475569;--card:#f8fafc;--ring:rgba(16,185,129,.55)}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;color:var(--ink);background:#fff;line-height:1.6}
    header,main,footer{max-width:1100px;margin:0 auto;padding:0 1rem}
    a{text-decoration:none;color:inherit}
    img{max-width:100%;height:auto}

    .topbar{display:flex;align-items:center;gap:.75rem;height:64px}
    .brand{display:flex;align-items:center;gap:.5rem;font-weight:800}
    .brand img{width:32px;height:32px}
    .grow{flex:1}
    .nav{display:flex;gap:.5rem;flex-wrap:wrap}
    .nav a{padding:.5rem .75rem;border-radius:.6rem;color:var(--muted)}
    .nav a.active{background:var(--card);border:1px solid #e2e8f0;color:var(--ink)}
    .cta{display:flex;gap:.5rem}
    .btn{appearance:none;border:0;border-radius:.75rem;padding:.65rem 1rem;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:.5rem}
    .btn-primary{background:var(--brand);color:#fff}
    .btn-outline{background:#fff;border:2px solid var(--brand);color:var(--brand)}
    .btn-ghost{background:#f1f5f9;color:#0f172a}
    .btn:focus{outline:3px solid var(--ring);outline-offset:2px}

    .hero{margin:1rem 0 1.25rem;padding:1rem;border-radius:1rem;background:var(--card);border:1px solid #e2e8f0}
    .grid{display:grid;gap:1rem}
    @media (min-width:800px){ .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))} }
    @media (max-width:799px){ .grid-3{grid-template-columns:1fr} }
    .card{background:#fff;border:1px solid #e2e8f0;border-radius:1rem;overflow:hidden}
    .card .body{padding:1rem}
    .muted{color:var(--muted)}
    .row{display:flex;gap:.5rem;flex-wrap:wrap;margin:.5rem 0}
    .textarea{width:100%;min-height:110px;padding:.75rem;border:1px solid #cbd5e1;border-radius:.65rem;resize:vertical}

    .recipe{display:flex;gap:.75rem;align-items:flex-start}
    .thumb{width:84px;height:84px;border-radius:.75rem;border:1px solid #e2e8f0;background:#fff;display:grid;place-items:center;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .actions{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.5rem}
    .badge{display:inline-flex;align-items:center;gap:.25rem;font-size:.85rem;background:#ecfeff;border:1px solid #a5f3fc;color:#155e75;border-radius:.5rem;padding:.15rem .4rem}
    .tag{display:inline-block;background:#fff7ed;border:1px solid #fed7aa;color:#7c2d12;padding:.15rem .5rem;border-radius:.5rem;font-size:.8rem}

    /* Lista spesa */
    .input{flex:1 1 220px;padding:.65rem .75rem;border:1px solid #cbd5e1;border-radius:.65rem}
    .list{list-style:none;margin:.5rem 0 2rem;padding:0}
    .list li{display:flex;align-items:center;gap:.5rem;border-bottom:1px dashed #e2e8f0;padding:.5rem 0}
    .list li.done{opacity:.6;text-decoration:line-through}
    .qty{font-variant-numeric:tabular-nums;color:var(--muted)}

    /* Filtri */
    .filters{display:flex;flex-wrap:wrap;gap:.5rem;margin:.5rem 0}
    .chip{display:inline-flex;align-items:center;gap:.35rem;padding:.4rem .6rem;border:1px solid #e2e8f0;border-radius:999px;background:#fff;font-size:.9rem;cursor:pointer}
    .chip input{margin:0}
    select{padding:.55rem .7rem;border:1px solid #cbd5e1;border-radius:.6rem;background:#fff}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <a href="#/" class="brand">
        <img src="assets/icons/icon-192.png" alt="Logo" />
        <span>Ricette & Lista Spesa</span>
      </a>
      <div class="grow"></div>
      <nav class="nav" id="mainNav">
        <a href="#/" data-route="/">Home</a>
        <a href="#/generator" data-route="/generator">Generatore</a>
        <a href="#/saved" data-route="/saved">Salvate</a>
        <a href="#/list" data-route="/list">Lista Spesa</a>
      </nav>
      <div class="cta">
        <button id="installBtn" class="btn btn-primary hidden">Installa</button>
        <a class="btn btn-outline" href="https://whatsapp.com/channel/0029Vb6la2aCHDycDs8wsn2h" target="_blank" rel="noopener">WhatsApp</a>
      </div>
    </div>
  </header>

  <main id="app"></main>

  <footer>
    © 2025 Ricette & Lista Spesa — Demo
  </footer>

  <script>
    const MOCK_RECIPES = [
      { id:'r1', title:'Pasta al pomodoro veloce', img:'assets/icons/icon-512.png', time:15, cost:'€', tags:['veloce','economica','vegetariana'], ingredients:['pasta','pomodoro','aglio','olio','sale'], steps:['Metti a bollire l’acqua e sala','Soffriggi aglio in olio, aggiungi pomodoro','Cuoci la pasta, manteca con il sugo'] },
      { id:'r2', title:'Frittata svuota frigo', img:'assets/icons/icon-512.png', time:10, cost:'€', tags:['antispreco','proteica','vegetariana'], ingredients:['uova','formaggio','verdure','sale','pepe'], steps:['Sbatti uova con sale e pepe','Aggiungi verdure e formaggio','Cuoci in padella 6 minuti'] },
      { id:'r3', title:'Insalata di ceci e tonno', img:'assets/icons/icon-512.png', time:7, cost:'€', tags:['fredda','senza fornelli'], ingredients:['ceci','tonno','olio','limone','sale'], steps:['Scola ceci e tonno','Condisci con olio e limone','Regola di sale'] },
      { id:'r4', title:'Curry di ceci e spinaci', img:'assets/icons/icon-512.png', time:20, cost:'€€', tags:['speziata','vegetariana'], ingredients:['ceci','spinaci','curry','latte di cocco','cipolla','olio','sale'], steps:['Soffriggi cipolla e curry','Aggiungi ceci e latte di cocco','Unisci spinaci e aggiusta di sale'] },
      { id:'r5', title:'Pollo al limone e zucchine', img:'assets/icons/icon-512.png', time:25, cost:'€€€', tags:['secondo','leggera'], ingredients:['pollo','limone','zucchine','olio','sale','pepe'], steps:['Rosola il pollo','Sfuma con limone','Aggiungi zucchine a rondelle e cuoci'] }
    ]

    const ALL_TAGS = Array.from(new Set(MOCK_RECIPES.flatMap(r => r.tags))).sort()
    const COST_ORDER = {'€':1,'€€':2,'€€€':3}

    const SAVED_KEY = 'demo_saved_recipes'
    const saved = new Set(JSON.parse(localStorage.getItem(SAVED_KEY) || '[]'))
    const persistSaved = () => localStorage.setItem(SAVED_KEY, JSON.stringify([...saved]))

    const LIST_KEY = 'demo_shopping_list'
    const loadList = () => { try { return JSON.parse(localStorage.getItem(LIST_KEY) || '[]') } catch { return [] } }
    const saveList = (arr) => localStorage.setItem(LIST_KEY, JSON.stringify(arr))

    const routes = { '/': renderHome, '/generator': renderGenerator, '/saved': renderSaved, '/recipe': renderRecipe, '/list': renderList }
    const setActiveNav = (path) => document.querySelectorAll('#mainNav a').forEach(a => a.classList.toggle('active', a.getAttribute('href') === '#'+path))

    function navigate(){
      const hash = location.hash || '#/'
      const [_, rawPath, id] = hash.split('/')
      const path = '/'+(rawPath || '')
      setActiveNav(path)
      if (path === '/recipe' && id) return routes['/recipe'](id)
      ;(routes[path] || routes['/'])()
    }
    window.addEventListener('hashchange', navigate)

    function renderHome(){
      const el = document.getElementById('app')
      el.innerHTML = `
        <section class="hero">
          <h1>Ricette smart in base a ciò che hai</h1>
          <p class="muted">Prova il generatore. Salva le preferite. Aggiungi gli ingredienti alla Lista.</p>
        </section>
        <section>
          <h2>Consigliate oggi</h2>
          <div class="grid grid-3" id="homeList"></div>
        </section>
      `
      const mount = document.getElementById('homeList')
      renderCards(MOCK_RECIPES.slice(0,3), mount)
    }

    function renderGenerator(){
      const el = document.getElementById('app')
      el.innerHTML = `
        <section class="card"><div class="body">
          <h2>Generatore ricette</h2>
          <p class="muted">Scrivi ingredienti separati da virgola. Esempio: pasta, tonno, pomodoro</p>
          <textarea id="ing" class="textarea" placeholder="es. uova, formaggio, verdure"></textarea>

          <div class="filters">
            <label>Tempo max
              <select id="fTime">
                <option value="">Qualsiasi</option>
                <option value="10">10 min</option>
                <option value="15">15 min</option>
                <option value="20">20 min</option>
                <option value="25">25 min</option>
                <option value="30">30 min</option>
              </select>
            </label>

            <label>Costo max
              <select id="fCost">
                <option value="">Qualsiasi</option>
                <option value="€">€</option>
                <option value="€€">€€</option>
                <option value="€€€">€€€</option>
              </select>
            </label>
          </div>

          <div id="tags" class="filters"></div>

          <div class="row">
            <button id="genBtn" class="btn btn-primary">Filtra</button>
            <button id="clearBtn" class="btn btn-ghost">Pulisci</button>
          </div>
        </div></section>

        <section style="margin-top:1rem">
          <h2>Risultati</h2>
          <div class="grid grid-3" id="genList"></div>
        </section>
      `
      const ing = document.getElementById('ing')
      const list = document.getElementById('genList')
      const fTime = document.getElementById('fTime')
      const fCost = document.getElementById('fCost')
      const tagsBox = document.getElementById('tags')

      tagsBox.innerHTML = ALL_TAGS.map(t => `
        <label class="chip">
          <input type="checkbox" value="${t}"> <span>${t}</span>
        </label>
      `).join('')

      function run(){
        const tokens = ing.value.toLowerCase().split(',').map(s=>s.trim()).filter(Boolean)
        const tSel = [...tagsBox.querySelectorAll('input:checked')].map(i=>i.value)
        const maxTime = Number(fTime.value || 0)
        const maxCost = fCost.value

        let res = MOCK_RECIPES.slice()

        if (tokens.length){
          res = res.filter(r => tokens.some(t => r.ingredients.includes(t)))
        }
        if (tSel.length){
          res = res.filter(r => tSel.every(tag => r.tags.includes(tag)))
        }
        if (maxTime){
          res = res.filter(r => r.time <= maxTime)
        }
        if (maxCost){
          res = res.filter(r => COST_ORDER[r.cost] <= COST_ORDER[maxCost])
        }

        list.innerHTML = ''
        if (!res.length){
          list.innerHTML = `<p class="muted">Nessun risultato. Amplia i filtri o controlla la grafia.</p>`
        } else {
          renderCards(res, list)
        }
      }

      document.getElementById('genBtn').addEventListener('click', run)
      document.getElementById('clearBtn').addEventListener('click', ()=>{
        ing.value = ''
        fTime.value = ''
        fCost.value = ''
        tagsBox.querySelectorAll('input').forEach(i => i.checked = false)
        list.innerHTML = ''
      })
    }

    function renderSaved(){
      const el = document.getElementById('app')
      el.innerHTML = `
        <section class="hero">
          <h2>Ricette salvate</h2>
          <p class="muted">Restano sul dispositivo.</p>
        </section>
        <section>
          <div class="grid grid-3" id="savedList"></div>
        </section>
      `
      const mount = document.getElementById('savedList')
      const data = MOCK_RECIPES.filter(r => saved.has(r.id))
      if (!data.length) mount.innerHTML = `<p class="muted">Vuota. Salva dal catalogo o dal generatore.</p>`
      else renderCards(data, mount)
    }

    function renderRecipe(id){
      const rec = MOCK_RECIPES.find(x => x.id === id)
      const el = document.getElementById('app')
      if (!rec){
        el.innerHTML = `<p class="muted">Ricetta non trovata.</p>`
        return
      }
      el.innerHTML = `
        <article class="card"><div class="body">
          <a href="#/" class="btn btn-ghost">Torna</a>
          <h1 style="margin-top:.5rem">${rec.title}</h1>
          <div class="row">
            <span class="badge">⏱ ${rec.time} min</span>
            <span class="badge">💶 ${rec.cost}</span>
            ${rec.tags.map(t=>`<span class="tag">${t}</span>`).join('')}
          </div>
          <div class="row" style="margin:.75rem 0">
            <div class="thumb"><img src="${rec.img}" alt="${rec.title}"></div>
          </div>
          <h3>Ingredienti</h3>
          <ul>${rec.ingredients.map(i=>`<li>• ${i}</li>`).join('')}</ul>
          <h3>Passi</h3>
          <ol>${rec.steps.map(s=>`<li>${s}</li>`).join('')}</ol>
          <div class="actions">
            <button class="btn btn-primary" id="toggleSave">${saved.has(rec.id) ? 'Rimuovi dai salvati' : 'Salva'}</button>
            <button class="btn btn-outline" id="addToList">Aggiungi ingredienti alla Lista</button>
            <a class="btn btn-ghost" href="#/list">Apri Lista Spesa</a>
          </div>
        </div></article>
      `
      document.getElementById('toggleSave').addEventListener('click', ()=>{
        if (saved.has(rec.id)) saved.delete(rec.id)
        else saved.add(rec.id)
        persistSaved()
        location.replace(`#/recipe/${rec.id}`)
      })

      document.getElementById('addToList').addEventListener('click', ()=>{
        const current = loadList()
        rec.ingredients.forEach(name => {
          const idx = current.findIndex(x => x.name.toLowerCase() === name.toLowerCase())
          if (idx >= 0) current[idx].qty = String(Number(current[idx].qty || 1) + 1)
          else current.push({ id: uid(), name, qty:'1', done:false })
        })
        saveList(current)
        location.hash = '#/list'
      })
    }

    function renderList(){
      const el = document.getElementById('app')
      el.innerHTML = `
        <section class="hero">
          <h2>Lista Spesa</h2>
          <p class="muted">Funziona offline. Dati sul dispositivo.</p>
        </section>
        <section class="card"><div class="body">
          <div class="row">
            <input id="lsName" class="input" placeholder="Es. latte intero" />
            <input id="lsQty" class="input" style="max-width:110px" placeholder="Qtà" />
            <button id="lsAdd" class="btn btn-primary">Aggiungi</button>
            <button id="lsClear" class="btn btn-ghost">Svuota</button>
          </div>
          <ul id="lsList" class="list"></ul>
        </div></section>
      `
      const name = document.getElementById('lsName')
      const qty  = document.getElementById('lsQty')
      const add  = document.getElementById('lsAdd')
      const clear= document.getElementById('lsClear')
      const list = document.getElementById('lsList')

      function render(){
        const items = loadList()
        list.innerHTML = ''
        if (!items.length){
          list.innerHTML = `<li class="muted">Lista vuota</li>`
          return
        }
        items.forEach(it=>{
          const li = document.createElement('li')
          if (it.done) li.classList.add('done')

          const cb = document.createElement('input')
          cb.type = 'checkbox'
          cb.checked = it.done
          cb.addEventListener('change', ()=>{
            it.done = cb.checked
            saveList(items)
            render()
          })

          const label = document.createElement('span')
          label.className = 'grow'
          label.textContent = it.name

          const q = document.createElement('span')
          q.className = 'qty'
          q.textContent = `×${it.qty || '1'}`

          const del = document.createElement('button')
          del.className = 'btn btn-ghost'
          del.textContent = 'Rimuovi'
          del.addEventListener('click', ()=>{
            const i = items.findIndex(x => x.id === it.id)
            if (i > -1){
              items.splice(i,1)
              saveList(items)
              render()
            }
          })

          li.append(cb, label, q, del)
          list.append(li)
        })
      }

      function addItem(){
        const v = (name.value || '').trim()
        const qv = (qty.value || '1').trim()
        if (!v) return
        const items = loadList()
        const idx = items.findIndex(x => x.name.toLowerCase() === v.toLowerCase())
        if (idx >= 0) items[idx].qty = String(Number(items[idx].qty || 1) + Number(qv || 1))
        else items.unshift({ id: uid(), name:v, qty:qv || '1', done:false })
        saveList(items)
        name.value = ''
        qty.value = ''
        render()
      }

      add.addEventListener('click', addItem)
      name.addEventListener('keydown', e => { if (e.key === 'Enter') addItem() })
      qty.addEventListener('keydown',  e => { if (e.key === 'Enter') addItem() })
      clear.addEventListener('click', ()=>{
        const items = loadList()
        if (!items.length) return
        if (!confirm('Svuotare tutta la lista?')) return
        saveList([])
        render()
      })

      render()
    }

    function uid(){ return Math.random().toString(36).slice(2,9) }

    function renderCards(arr, mount){
      arr.forEach(r=>{
        const card = document.createElement('article')
        card.className = 'card'
        card.innerHTML = `
          <div class="body">
            <div class="recipe">
              <div class="thumb"><img src="${r.img}" alt="${r.title}" /></div>
              <div class="grow">
                <a href="#/recipe/${r.id}"><strong>${r.title}</strong></a>
                <div class="row" style="margin:.25rem 0">
                  <span class="badge">⏱ ${r.time} min</span>
                  <span class="badge">💶 ${r.cost}</span>
                  ${r.tags.slice(0,2).map(t=>`<span class="tag">${t}</span>`).join('')}
                </div>
                <div class="actions">
                  <button data-save="${r.id}" class="btn ${saved.has(r.id)?'btn-ghost':'btn-primary'}">${saved.has(r.id)?'Rimuovi':'Salva'}</button>
                  <a class="btn btn-outline" href="#/recipe/${r.id}">Apri</a>
                </div>
              </div>
            </div>
          </div>
        `
        mount.appendChild(card)
      })

      mount.querySelectorAll('button[data-save]').forEach(b=>{
        b.addEventListener('click', ()=>{
          const id = b.getAttribute('data-save')
          if (saved.has(id)) saved.delete(id)
          else saved.add(id)
          persistSaved()
          navigate()
        })
      })
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(()=>{})
    }

    let deferredPrompt = null
    const installBtn = document.getElementById('installBtn')
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault()
      deferredPrompt = e
      installBtn.classList.remove('hidden')
    })
    installBtn?.addEventListener('click', async () => {
      if (!deferredPrompt) return
      try { await deferredPrompt.prompt() } catch {}
      deferredPrompt = null
      installBtn.classList.add('hidden')
    })

    if (!location.hash) location.hash = '#/'
    navigate()
  </script>
</body>
</html>
